<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UGCET Round 1 - ANTICLOCK</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f5f5f5;padding:10px}
.header{background:#1e40af;color:white;padding:20px;text-align:center;border-radius:10px;margin-bottom:20px}
.header h1{font-size:1.5rem;margin-bottom:5px}
.header p{font-size:0.9rem;opacity:0.9}
.card{background:white;padding:20px;border-radius:10px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.card h2{margin-bottom:15px;font-size:1.2rem}
.form-group{margin-bottom:15px}
.form-group label{display:block;margin-bottom:5px;font-weight:bold;font-size:0.9rem}
input,select{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:1rem}
input:focus,select:focus{outline:none;border-color:#1e40af}
.checkbox-group{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;margin-top:8px}
.checkbox-label{display:flex;align-items:center;gap:8px;padding:8px;background:#f8f9fa;border:2px solid #e9ecef;border-radius:6px;cursor:pointer;font-size:0.85rem}
.checkbox-label input{width:auto;margin:0}
.checkbox-label:hover{background:#e9ecef}
.btn{width:100%;padding:15px;border:none;background:#1e40af;color:white;font-size:1rem;font-weight:bold;border-radius:8px;cursor:pointer}
.btn:active{transform:scale(0.98)}
.btn-small{padding:10px 20px;width:auto;font-size:0.9rem}
.btn-success{background:#10b981}
table{width:100%;border-collapse:collapse;font-size:0.85rem}
th,td{padding:10px 8px;text-align:left;border-bottom:1px solid #ddd}
th{background:#f0f0f0;font-weight:bold;position:sticky;top:0}
.hidden{display:none}
.info{background:#e0f2fe;border:1px solid:#0ea5e9;color:#0c4a6e;padding:10px;border-radius:6px;margin-top:8px;font-size:0.85rem}
.results-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:10px}
.table-container{max-height:500px;overflow:auto;border:1px solid #ddd;border-radius:8px}
</style>
</head>
<body>

<div class="header">
<h1>ğŸ“ UGCET 2025 Round 1</h1>
<p>ANTICLOCK COACHING ACADEMY - 6362324224</p>
</div>

<div class="card">
<h2>ğŸ“ Search Colleges</h2>

<div class="form-group">
<label>Your Rank *</label>
<input type="number" id="rank" placeholder="Enter your rank" required>
<div id="rangeInfo" class="info hidden"></div>
</div>

<div class="form-group">
<label>Category *</label>
<select id="category" required>
<option value="">Select Category</option>
<option value="GM">GM - General Merit</option>
<option value="1G">1G - Category 1</option>
<option value="2AG">2AG - Category 2A</option>
<option value="2BG">2BG - Category 2B</option>
<option value="3AG">3AG - Category 3A</option>
<option value="3BG">3BG - Category 3B</option>
<option value="SCG">SCG - Scheduled Caste</option>
<option value="STG">STG - Scheduled Tribe</option>
</select>
</div>

<div class="form-group">
<label>Reservation (Optional)</label>
<div class="checkbox-group" style="grid-template-columns:repeat(2,1fr)">
<label class="checkbox-label"><input type="checkbox" id="resK" value="K"><span>Kannada (K)</span></label>
<label class="checkbox-label"><input type="checkbox" id="resR" value="R"><span>Rural (R)</span></label>
</div>
</div>

<div class="form-group">
<label>Districts (Optional - Select specific or leave blank for all)</label>
<div class="checkbox-group">
<label class="checkbox-label"><input type="checkbox" name="district" value="BLR"><span>Bangalore</span></label>
<label class="checkbox-label"><input type="checkbox" name="district" value="MYS"><span>Mysore</span></label>
<label class="checkbox-label"><input type="checkbox" name="district" value="MNG"><span>Mangalore</span></label>
<label class="checkbox-label"><input type="checkbox" name="district" value="BLM"><span>Belgaum</span></label>
<label class="checkbox-label"><input type="checkbox" name="district" value="HBL"><span>Hubli</span></label>
<label class="checkbox-label"><input type="checkbox" name="district" value="DWD"><span>Dharwad</span></label>
</div>
</div>

<div class="form-group">
<label>Branches (Optional - Select specific or leave blank for all)</label>
<div class="checkbox-group">
<label class="checkbox-label"><input type="checkbox" name="branch" value="CS"><span>CS (Pure)</span></label>
<label class="checkbox-label"><input type="checkbox" name="branch" value="AI"><span>AI/ML</span></label>
<label class="checkbox-label"><input type="checkbox" name="branch" value="DS"><span>Data Science</span></label>
<label class="checkbox-label"><input type="checkbox" name="branch" value="CY"><span>Cyber Sec</span></label>
<label class="checkbox-label"><input type="checkbox" name="branch" value="IS"><span>Info Science</span></label>
<label class="checkbox-label"><input type="checkbox" name="branch" value="EC"><span>EC</span></label>
<label class="checkbox-label"><input type="checkbox" name="branch" value="EE"><span>EE</span></label>
<label class="checkbox-label"><input type="checkbox" name="branch" value="ME"><span>Mechanical</span></label>
<label class="checkbox-label"><input type="checkbox" name="branch" value="CE"><span>Civil</span></label>
</div>
</div>

<button class="btn" onclick="search()">ğŸ” Find Colleges</button>
</div>

<div id="resultsCard" class="card hidden">
<div class="results-header">
<h2>Results: <span id="count">0</span></h2>
<button class="btn btn-small btn-success" onclick="download()">â¬‡ Download</button>
</div>
<div class="table-container">
<table>
<thead><tr><th>No</th><th>Code</th><th>College</th><th>Branch</th><th>District</th><th>Cutoff</th></tr></thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>

<script>
const BR={CS:'CS (Pure)',AI:'AI/ML',DS:'Data Science',CY:'Cyber Security',IO:'IoT',IS:'Info Science',EC:'Electronics & Comm',EL:'Electronics',EE:'Electrical',ME:'Mechanical',CE:'Civil',AE:'Aerospace',AU:'Automobile',MT:'Mechatronics',RO:'Robotics',CH:'Chemical',BT:'Biotech',OT:'Other'};
const DI={BLR:'Bangalore',MYS:'Mysore',MNG:'Mangalore',BLM:'Belgaum',HBL:'Hubli',DWD:'Dharwad',TMK:'Tumkur',GLB:'Gulbarga',BJP:'Bijapur',BLY:'Bellary',UDP:'Udupi',DVG:'Davangere',SHM:'Shimoga',HSN:'Hassan',MDY:'Mandya',CTD:'Chitradurga',CMG:'Chikmagalur',RCH:'Raichur',BDR:'Bidar',BGK:'Bagalkot',GDG:'Gadag',HVR:'Haveri',KPL:'Koppal',RMG:'Ramanagara',CBP:'Chikballapur',CMR:'Chamarajanagar',KDG:'Kodagu',KLR:'Kolar',UKN:'Uttara Kannada',VJN:'Vijayanagara',YDG:'Yadgir',OTH:'Other'};

let colleges={},data=[],results=[];

window.addEventListener('load',async()=>{
    await loadData();
    setupListeners();
});

async function loadData(){
    try{
        const res=await fetch('data_round1.json');
        const json=await res.json();
        colleges=json.c;
        data=json.d;
        console.log(`âœ… Loaded ${data.length} records, ${Object.keys(colleges).length} colleges`);
    }catch(e){
        alert('Failed to load data. Please refresh.');
    }
}

function setupListeners(){
    document.getElementById('rank').addEventListener('input',e=>{
        const rank=parseInt(e.target.value);
        const info=document.getElementById('rangeInfo');
        if(rank&&!isNaN(rank)){
            const r=calcRange(rank);
            info.textContent=`âœ¨ Search Range: ${r.lower.toLocaleString()} - ${r.upper.toLocaleString()}`;
            info.classList.remove('hidden');
        }else{
            info.classList.add('hidden');
        }
    });
}

function calcRange(rank){
    if(rank<10000)return{lower:Math.max(0,rank-5000),upper:rank+5000};
    if(rank<50000)return{lower:Math.max(0,rank-8500),upper:rank+8500};
    if(rank<100000)return{lower:Math.max(0,rank-12500),upper:rank+12500};
    if(rank<200000)return{lower:Math.max(0,rank-25000),upper:rank+25000};
    return{lower:Math.max(0,rank-45000),upper:rank+45000};
}

function search(){
    const rank=parseInt(document.getElementById('rank').value);
    const cat=document.getElementById('category').value;
    
    if(!rank||!cat){
        alert('Please enter rank and select category');
        return;
    }
    
    const hasK=document.getElementById('resK').checked;
    const hasR=document.getElementById('resR').checked;
    const dists=Array.from(document.querySelectorAll('input[name="district"]:checked')).map(cb=>cb.value);
    const brs=Array.from(document.querySelectorAll('input[name="branch"]:checked')).map(cb=>cb.value);
    
    const rng=calcRange(rank);
    
    console.log(`Searching: Rank ${rank} (${rng.lower}-${rng.upper}), Category ${cat}, K=${hasK}, R=${hasR}`);
    console.log(`Districts: ${dists.length>0?dists:'All'}, Branches: ${brs.length>0?brs:'All'}`);
    
    results=data.filter(row=>{
        // Category match
        if(row.t!==cat)return false;
        
        // Get college
        const coll=colleges[Object.keys(colleges).find(k=>colleges[k].i===row.i)];
        if(!coll)return false;
        
        // District filter (only if districts selected)
        if(dists.length>0&&!dists.includes(coll.d))return false;
        
        // Branch filter (only if branches selected)
        if(brs.length>0&&!brs.includes(row.b))return false;
        
        // Rank check: [Base, Kannada, Rural]
        let cutoff=row.r[0]; // Default to base
        if(hasK&&row.r.length>=2)cutoff=row.r[1];
        else if(hasR&&row.r.length>=3)cutoff=row.r[2];
        
        return cutoff&&cutoff>=rng.lower&&cutoff<=rng.upper;
    });
    
    // Sort by cutoff
    const hasK=document.getElementById('resK').checked;
    const hasR=document.getElementById('resR').checked;
    results.sort((a,b)=>{
        const getCutoff=r=>{
            if(hasK&&r.r.length>=2)return r.r[1];
            if(hasR&&r.r.length>=3)return r.r[2];
            return r.r[0];
        };
        return getCutoff(a)-getCutoff(b);
    });
    
    displayResults();
    console.log(`âœ… Found ${results.length} colleges`);
}

function displayResults(){
    const hasK=document.getElementById('resK').checked;
    const hasR=document.getElementById('resR').checked;
    
    document.getElementById('count').textContent=results.length;
    document.getElementById('resultsCard').classList.remove('hidden');
    
    if(results.length===0){
        document.getElementById('tbody').innerHTML='<tr><td colspan="6" style="text-align:center;padding:2rem">No colleges found. Try adjusting your criteria.</td></tr>';
        return;
    }
    
    document.getElementById('tbody').innerHTML=results.map((row,idx)=>{
        const coll=colleges[Object.keys(colleges).find(k=>colleges[k].i===row.i)];
        const code=Object.keys(colleges).find(k=>colleges[k].i===row.i);
        
        let cutoff=row.r[0];
        if(hasK&&row.r.length>=2)cutoff=row.r[1];
        else if(hasR&&row.r.length>=3)cutoff=row.r[2];
        
        return`<tr><td>${idx+1}</td><td><strong>${code}</strong></td><td title="${coll.n}">${coll.n.substr(0,50)}${coll.n.length>50?'...':''}</td><td>${BR[row.b]||row.b}</td><td>${DI[coll.d]||coll.d}</td><td><strong>${cutoff||'-'}</strong></td></tr>`;
    }).join('');
}

function download(){
    if(results.length===0){alert('No results to download');return;}
    
    const hasK=document.getElementById('resK').checked;
    const hasR=document.getElementById('resR').checked;
    const rank=document.getElementById('rank').value;
    const cat=document.getElementById('category').value;
    
    let csv='';
    csv+='â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
    csv+='ANTICLOCK COACHING ACADEMY\n';
    csv+='Contact: 6362324224\n';
    csv+='UGCET 2025 Round 1 Counselling Results\n';
    csv+='â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
    csv+=`Rank: ${rank}\n`;
    csv+=`Category: ${cat}\n`;
    csv+=`Reservation: ${hasK?'Kannada ':''}${hasR?'Rural ':''}${!hasK&&!hasR?'None':''}\n\n`;
    csv+='â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
    csv+='Results\n';
    csv+='â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n';
    csv+='S.No,Code,College,Branch,District,Cutoff\n';
    
    results.forEach((row,idx)=>{
        const coll=colleges[Object.keys(colleges).find(k=>colleges[k].i===row.i)];
        const code=Object.keys(colleges).find(k=>colleges[k].i===row.i);
        
        let cutoff=row.r[0];
        if(hasK&&row.r.length>=2)cutoff=row.r[1];
        else if(hasR&&row.r.length>=3)cutoff=row.r[2];
        
        const esc=s=>{if(!s)return'';s=String(s);if(s.includes(',')||s.includes('"'))return`"${s.replace(/"/g,'""')}"`;return s;};
        csv+=`${idx+1},${esc(code)},${esc(coll.n)},${esc(BR[row.b]||row.b)},${esc(DI[coll.d]||coll.d)},${cutoff}\n`;
    });
    
    csv+='\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
    csv+=`Total: ${results.length} colleges\n`;
    csv+=`Date: ${new Date().toLocaleString()}\n\n`;
    csv+='ANTICLOCK COACHING ACADEMY\n';
    csv+='Contact: 6362324224\n';
    csv+='â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
    
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
    const link=document.createElement('a');
    link.href=URL.createObjectURL(blob);
    link.download=`ANTICLOCK_Round1_${cat}_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
}
</script>
</body>
</html>
